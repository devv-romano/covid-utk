<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>COVID@UTK</title>
    <link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<header class="bg-gray-900 p-4 text-white font-bold flex justify-between items-center">
    <span>COVID@UTK</span>
    <small class="font-normal pl-4"><em>Not officially affiliated with the University of Tennessee</em></small>
</header>
<div class="p-4">
    <section title="Introduction">
        <p>This is a collection of data, links, and tips to spread awareness of COVID-19 during the Fall 2020 Semester at UTK.</p>
    </section>
    <div class="flex flex-wrap">
        <section title="New cases" class="my-4 w-full lg:w-1/3 md:w-1/2" id="new-cases">
            <h1 class="font-bold text-xl">New Cases in TN</h1>
            <canvas id="new-cases-chart"></canvas>
            <small>Source: <a class="font-bold" href="https://covidtracking.com/data">Covid Tracking Project</a></small>
        </section>
        <section title="New deaths" class="my-4 w-full lg:w-1/3 md:w-1/2" id="new-deaths">
            <h1 class="font-bold text-xl">New Deaths in TN</h1>
            <canvas id="new-deaths-chart"></canvas>
            <small>Source: <a class="font-bold" href="https://covidtracking.com/data">Covid Tracking Project</a></small>
        </section>
        <section title="Hospitalized" class="my-4 w-full lg:w-1/3 md:w-1/2" id="hospitalized">
            <h1 class="font-bold text-xl">Hospitalizations in TN</h1>
            <canvas id="hospitalized-chart"></canvas>
            <small>Source: <a class="font-bold" href="https://covidtracking.com/data">Covid Tracking Project</a></small>
        </section>
        <section title="Knox Cases" class="my-4 w-full lg:w-1/3 md:w-1/2" id="knox-cases">
            <h1 class="font-bold text-xl">Cases in Knox County</h1>
            <canvas id="knox-cases-chart"></canvas>
            <small>Source: <a class="font-bold" href="https://github.com/nytimes/covid-19-data">New York Times Covid-19 Data</a></small>
        </section>
        <section title="Knox Deaths" class="my-4 w-full lg:w-1/3 md:w-1/2" id="knox-deaths">
            <h1 class="font-bold text-xl">Deaths in Knox County</h1>
            <canvas id="knox-deaths-chart"></canvas>
            <small>Source: <a class="font-bold" href="https://github.com/nytimes/covid-19-data">New York Times Covid-19 Data</a></small>
        </section>
        <section title="More Sources" class="my-4 w-full lg:w-1/3 md:w-1/2" id="more-sources">
            <h1 class="font-bold text-xl">More sources</h1>
            <div class="flex flex-col p-4">
                <a class="italic font-bold" href="https://www.utk.edu/coronavirus/">UTK Coronavirus Updates</a>
                <a class="italic font-bold" href="https://covid.knoxcountytn.gov/case-count.html">Knox County Health Dept</a>
                <a class="italic font-bold" href="https://knoxvilletn.gov/government/mayors_office/c_o_v_i_d-19___coronavirus_/daily_case_counts">Knoxville Mayor's Office</a>
                <a class="italic font-bold" href="https://www.tn.gov/health/cedep/ncov/data.html">Tennessee Health Dept</a>
                <a class="italic font-bold" href="https://www.cdc.gov/coronavirus/2019-ncov/prevent-getting-sick/prevention.html">CDC Prevention Guidelines</a>
                <a class="italic font-bold" href="https://www.cdc.gov/coronavirus/2019-ncov/index.html">CDC Symptom Checker</a>
            </div>
        </section>
    </div>
    <footer class="border-t my-5 flex flex-col items-end">
        <small class="inline-block text-right my-4">Made with â™¥ by Nick Romano (@nromanodev)</small>
        <div>
            <style>.bmc-button img{height: 34px !important;width: 35px !important;margin-bottom: 1px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{padding: 7px 15px 7px 10px !important;line-height: 35px !important;height:51px !important;text-decoration: none !important;display:inline-flex !important;color:#ffffff !important;background-color:#FF813F !important;border-radius: 5px !important;border: 1px solid transparent !important;padding: 7px 15px 7px 10px !important;font-size: 28px !important;letter-spacing:0.6px !important;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:'Cookie', cursive !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#ffffff !important;}</style><link href="https://fonts.googleapis.com/css?family=Cookie" rel="stylesheet"><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/nromano"><img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="Buy me a coffee"><span style="margin-left:5px;font-size:28px !important;">Buy me a coffee</span></a>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script>
        let data = [];
        let dates = [];
        let deaths = [];
        let deathsIncrease = [];
        let hospitalizedCurrently = [];
        let positiveCases = [];
        let positiveIncrease = [];
        fetch('https://covidtracking.com/api/v1/states/tn/daily.json')
        .then(r => r.json().then(json => data = json.reverse()))
        .then(() => console.log(data))
        .then(() => {
            dates = data.map(d => d.date);
            deaths = data.map(d => d.death);
            deathsIncrease = data.map(d => d.deathIncrease);
            hospitalizedCurrently = data.map(d => d.hospitalizedCurrently);
            positiveCases = data.map(d => d.positive);
            positiveIncrease = data.map(d => d.positiveIncrease);
        })
        .then(() => {
            initChart({
                id: 'new-cases-chart',
                dates,
                data: positiveIncrease,
                label: '# of new cases in TN',
                color: 'orange'
            });
            initChart({
                id: 'new-deaths-chart',
                dates,
                data: deathsIncrease,
                label: '# of new deaths in TN',
                color: 'red'
            });
            initChart({
                id: 'hospitalized-chart',
                dates,
                data: hospitalizedCurrently,
                label: '# of hospitalizations in TN',
                color: 'blue'
            });

        })

        function initChart({id, dates, data, label, color}) {
            let ctx = document.getElementById(id).getContext('2d');
            let myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: color,
                        borderColor: color,
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        }
    </script>

    <script>
        const url = "https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv";
        let csv = '';
        let knoxRows = [];
        fetch(url)
        .then(r => r.text().then(text => csv = text))
        .then(() => {
            let rows = csv.split('\n').filter(row => row.includes('Knox,Tennessee'));
            rows = rows.map(row => {
                const parts = row.split(',');
                console.log(parts);
                return {
                    date: parts[0],
                    cases: parts[4],
                    deaths: parts[5]
                };
            })
            knoxRows = rows;
        })
        .then(() => {
            const dates = knoxRows.map(row => row.date);
            const cases = knoxRows.map(row => row.cases);
            const deaths = knoxRows.map(row => row.deaths);
            initChart({
                id: 'knox-cases-chart',
                dates,
                data: cases,
                label: '# of cases in Knox County',
                color: 'orange'
            });
            initChart({
                id: 'knox-deaths-chart',
                dates,
                data: deaths,
                label: '# of deaths in Knox County',
                color: 'red'
            });
        });
    </script>
</div>
</body>
</html>